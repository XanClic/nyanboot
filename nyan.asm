use16

org 0x7C00

jmp 0x0000:_start

rainbow_offset db 0

_start:

push    cs
pop     ds

push    word 0xB800
pop     es

mov     si,palette
mov     cx,14
palette_loop:
mov     dx,0x3C8
outsb
inc     dx
outsb
outsb
outsb
loop    palette_loop


pinkie_pie:
xor     di,di
mov     ax,0x00DB
mov     cx,2000
rep     stosw


mov     ah,0xDB

xor     ch,ch

mov     dl,[rainbow_offset]
mov     si,479

mov     bp,53

draw_rainbow:
add     si,2
mov     di,si

mov     al,dl
shr     al,4
jnc     no_inc
add     di,160
no_inc:
mov     al,8
mov     cl,6
draw_bows:
mov     bl,3
draw_bow_line:
stosw
add     di,158
dec     bl
jnz     draw_bow_line
inc     al
loop    draw_bows

inc     dl
dec     bp
jnz     draw_rainbow

inc     byte [rainbow_offset]

call    draw_pic

call    sleep_some
jmp     pinkie_pie


draw_pic:
mov     di,427
mov     si,pic
draw_pic_repeat:
lodsb
test    al,al
jz      draw_pic_quit
mov     cl,al
shr     cl,4
cmp     al,0xFF
jne     standard_procedure
lodsb
mov     cl,al
xor     al,al
standard_procedure:
and     al,0xF
jz      draw_pic_transp
rep     stosw
jmp     draw_pic_repeat
draw_pic_quit:
ret

draw_pic_transp:
add     di,cx
add     di,cx
jmp     draw_pic_repeat

sleep_some:
mov     ah,0x86
mov     dx,0x4000
xor     cx,cx
int     0x15
ret


palette:
;  bg blue     black     cream?       frosting     pieces of stuff  cat fur      cat cheeks    white        red         orange       yellow       green       blue         violet
db 0,0,13,25,  1,0,0,0,  2,63,50,38,  3,63,38,63,  4,63,13,38,      5,38,38,38,  20,63,38,38,  7,63,63,63,  56,63,0,0,  57,63,38,0,  58,63,63,0,  59,0,63,0,  60,0,38,63,  61,25,13,63

pic:
db 0xF1, 0x31, 0xFF, 61
db 0x11, 0xF2, 0x32, 0x11, 0xFF, 59
db 0x11, 0x32, 0xE3, 0x32, 0x11, 0xFF, 58
db 0x11, 0x22, 0x63, 0x14, 0x33, 0x14, 0x53, 0x22, 0x11, 0xFF, 58
db 0x11, 0x12, 0x23, 0x14, 0xF3, 0x12, 0x11, 0xFF, 58
db 0x11, 0x12, 0xC3, 0x21, 0x13, 0x14, 0x23, 0x12, 0x11, 0x20, 0x21, 0xFF, 54
db 0x11, 0x12, 0xB3, 0x11, 0x25, 0x11, 0x33, 0x12, 0x11, 0x10, 0x11, 0x25, 0x11, 0xFF, 53
db 0x11, 0x12, 0x63, 0x14, 0x43, 0x11, 0x35, 0x11, 0x23, 0x12, 0x21, 0x35, 0x11, 0xFF, 53
db 0x11, 0x12, 0xB3, 0x11, 0x45, 0x41, 0x45, 0x11, 0xFF, 53
db 0x11, 0x12, 0x33, 0x14, 0x73, 0x11, 0xC5, 0x11, 0xFF, 52
db 0x21, 0x12, 0x73, 0x14, 0x23, 0x11, 0xE5, 0x11, 0xFF, 48
db 0x51, 0x12, 0x13, 0x14, 0x83, 0x11, 0x35, 0x17, 0x11, 0x55, 0x17, 0x11, 0x25, 0x11, 0xFF, 46
db 0x21, 0x45, 0x11, 0x12, 0xA3, 0x11, 0x35, 0x21, 0x35, 0x11, 0x15, 0x21, 0x25, 0x11, 0xFF, 46
db 0x11, 0x35, 0x31, 0x12, 0x53, 0x14, 0x43, 0x11, 0x15, 0x26, 0x95, 0x26, 0x11, 0xFF, 47
db 0x41, 0x10, 0x11, 0x22, 0x13, 0x14, 0x73, 0x11, 0x15, 0x26, 0x15, 0x11, 0x25, 0x11, 0x25, 0x11, 0x15, 0x26, 0x11, 0xFF, 52
db 0x11, 0x32, 0x93, 0x11, 0x35, 0x71, 0x25, 0x11, 0xFF, 53
db 0x21, 0xC2, 0x11, 0xA5, 0x11, 0xFF, 54
db 0x11, 0x15, 0xF1, 0x81, 0xFF, 55
db 0x11, 0x25, 0x11, 0x10, 0x11, 0x25, 0x11, 0x70, 0x11, 0x25, 0x11, 0x10, 0x11, 0x25, 0x11, 0xFF, 55
db 0x31, 0x30, 0x31, 0x80, 0x31, 0x20, 0x31

times 510-($-$$) db 0

dw 0xAA55
